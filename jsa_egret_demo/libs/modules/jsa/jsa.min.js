(function(){"use strict";if("undefined"==typeof e){var t=this,e=function(){};e.JSA=function(t,n,i){this.pack=e.fromJson(t,this),this.zip=n,this.textureHandler=i},e.JSAType={},e.JSAType.PACK=1,e.JSAType.FOLDER=2,e.JSAType.FILE=3,e.JSAType.SEP_PATH="/",e.JSADataType={},e.JSADataType.NORMAL_PNG=1,e.JSADataType.NORMAL_JPG=2,e.JSADataType.GRAY_SCALE_JPG=3,e.JSADataType.ALPHA_PNG=4,e.JSADataType.INVERSE_ALPHA_PNG=5,e.JSADataType.GRAY_SCALE_PNG=6,e.JSADataType.NORMAL_PNG8=7,e.JSADataType.TEXTURE_PNG=9,e.JSADataType.TEXTURE_PNG8=10,e.JSADataType.TEXTURE_JPG=11,e.textureHandler=function(){},e.isTexture=function(t){return t==e.JSADataType.TEXTURE_PNG||t==e.JSADataType.TEXTURE_PNG8||t==e.JSADataType.TEXTURE_JPG?!0:!1},e.JSAPack=function(){this.init()},e.JSAPack.prototype.init=function(){this.inited||(this.inited=!0,this.jsa=null,this.fileNum=0,this.itemNum=0)},e.JSAPack.prototype.getData=function(){var t=this.data;return t&&t.loadImage(),t},e.JSAInfo=function(){this.init()},e.JSAInfo.prototype.init=function(){this.inited||(this.inited=!0)},e.JSAData=function(){this.init()},e.JSAData.EVENT_LOADED="JSADataLoaded",e.JSAData.prototype.init=function(){this.inited||(this.inited=!0,e.EventTarget.call(this),this.texture=null,this.pack=null,this.img=null,this.imgSrc=null,this.imgMask=null)},e.JSAData.prototype.onloadHandler=function(t,n){this.imgSrc&&(this.imgSrc.complete||n)&&this.imgMask&&(this.imgMask.complete||n)&&(this.img.src=e.getMaskImg(this.imgSrc,this.imgMask,this.type,this.offset),this.oncomplet())},e.JSAData.prototype.onerrorHandler=function(t){this.oncomplet()},e.JSAData.prototype.onabortHandler=function(t){this.oncomplet()},e.JSAData.prototype.oncomplet=function(){this.resetImgHandler(this.imgSrc),this.resetImgHandler(this.imgMask),this.imgSrc=null,this.imgMask=null,this.loading=!1,this.dispatchEvent({type:e.JSAData.EVENT_LOADED,data:this.img})},e.JSAData.prototype.resetImgHandler=function(t){t&&(t.onload=null,t.onerror=null,t.onabort=null)},e.JSAData.prototype.loadImage=function(){var t,n,i,a,o,r,s=this,m=s.pack,p=m.jsa;if(e.isTexture(s.type)){var f=p.textureHandler||e.textureHandler;return f.call(p,s)}return s.img&&s.img.src||(s.img||(s.img=new Image),s.img.name=m.path,a=m.path.split(e.JSAType.SEP_PATH),s.mask?s.loading||(s.loading=!0,a[a.length-1]=s.src,o=p.zip.file(a.join(e.JSAType.SEP_PATH)),n=o.asUint8Array(),r=new Blob([n],{type:"image/jpeg"}),s.imgSrc=new Image,s.imgSrc.onload=function(){s.onloadHandler()},s.imgSrc.onerror=function(){s.onerrorHandler()},s.imgSrc.onabort=function(){s.onabortHandler},s.imgSrc.src=(window.URL||window.webkitURL).createObjectURL(r),a[a.length-1]=s.mask,o=p.zip.file(a.join(e.JSAType.SEP_PATH)),i=o.asUint8Array(),t="image/png",s.type==e.JSADataType.GRAY_SCALE_JPG&&(t="image/jpeg"),r=new Blob([i],{type:t}),s.imgMask=new Image,s.imgMask.onload=function(){s.onloadHandler()},s.imgMask.onerror=function(){s.onerrorHandler()},s.imgMask.onabort=function(){s.onabortHandler()},s.imgMask.src=(window.URL||window.webkitURL).createObjectURL(r),s.onloadHandler()):s.src&&(s.img||(s.img=new Image),a[a.length-1]=s.src,o=p.zip.file(a.join(e.JSAType.SEP_PATH)),n=o.asUint8Array(),t="image/jpeg",s.type==e.JSADataType.NORMAL_PNG&&(t="image/png"),r=new Blob([n],{type:t}),s.img.src=(window.URL||window.webkitURL).createObjectURL(r))),s.img},e.JSA.prototype.getPackItem=function(t){var n,i,a,o=this.pack,r=o;for(n=t.split(e.JSAType.SEP_PATH),i=0;i<n.length;i+=1){if(!o.items||0==o.items.length){r=null;break}for(a=0;a<o.items.length&&(r=o.items[a],r.name!==n[i]);a+=1);if(a>=o.items.length){r=null;break}o=r}return r},e.JSA.prototype.getPackData=function(t){return t.getData()},e.JSA.prototype.getPackItemData=function(t,n){var i,a=this.getPackItem(t),o=function(t){"function"==typeof n&&n.call(null,a)};return a?(i=this.getPackData(a),i&&!i.img.src?i.addEventListener(e.JSAData.EVENT_LOADED,o):o()):o(),i},e.fromJson=function(t,n){var i,a=0,o=0;if(t){if(t.__proto__=e.JSAPack.prototype,t.init(),t.jsa=n,t.info&&!t.info.inited&&(t.info.__proto__=e.JSAInfo.prototype,t.info.init()),t.items)for(a=0;a<t.items.length;a+=1)i=t.items[a],i.type==e.JSAType.FILE&&(o+=1),i.info&&!i.info.inited?(i.info.__proto__=e.JSAInfo.prototype,i.info.init()):i.info=t.info,e.fromJson(i,n);t.itemNum=a,t.fileNum=o,t.data&&(t.data.__proto__=e.JSAData.prototype,t.data.init(),t.data.pack=t)}return t},e.getCanvas=function(){return e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.display="none"),e.canvas},e.getMaskImg=function(t,n,i,a){var o,r=a?Number(a[2]):t.width,s=a?Number(a[3]):t.height,m=e.getCanvas();return m.width=r,m.height=s,o=m.getContext("2d"),o.clearRect(0,0,r,s),o.drawImage(t,0,0,r,s),o.globalCompositeOperation="xor",i==e.JSADataType.GRAY_SCALE_JPG||i==e.JSADataType.GRAY_SCALE_PNG?n=e.grayScale2InverseAlphaMask(n,a):i==e.JSADataType.ALPHA_PNG&&(o.globalCompositeOperation="destination-in"),o.drawImage(n,0,0,r,s),m.toDataURL("image/png")},e.grayScale2InverseAlphaMask=function(t,e){var n,i,a,o,r=e?Number(e[2]):t.width,s=e?Number(e[3]):t.height,m=document.createElement("canvas");for(m.width=r,m.height=s,o=m.getContext("2d"),o.drawImage(t,0,0,r,s),n=o.getImageData(0,0,r,s),i=n.data,a=i.length-1;a>0;a-=4)i[a]=255-i[a-3];return o.clearRect(0,0,r,s),o.putImageData(n,0,0),m},e.EventTarget=function(){var t={};this.addEventListener=this.on=function(e,n){void 0===t[e]&&(t[e]=[]),-1===t[e].indexOf(n)&&t[e].push(n)},this.dispatchEvent=this.emit=function(e){for(var n in t[e.type])t[e.type][n](e)},this.removeEventListener=this.off=function(e,n){var i=t[e].indexOf(n);-1!==i&&t[e].splice(i,1)}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.JSA=e):t.JSA=e}}).call(this),function(){"use strict";if("undefined"==typeof JSA.FPS){var t=this,e=function(){};e.HandlerInfo=function(t,n){this.handler=t,this.preframe=0,this.timeInfo=new e.TimeInfo(0,0,n)},e.TimeInfo=function(t,e,n){this.frame=t,this.time=e,this.preTime=0,this.interval=n?n:1},e.TimeInfo.prototype.getIntervalCount=function(t){return t||(t=this.interval),(this.time-this.preTime)/t|0},e.TimeInfo.prototype.sync=function(t){t&&(this.frame=t.frame,this.time=t.time,this.preTime=t.preTime,this.interval=t.interval)},e.prefps=30,e.fps=30,e.requestId=0,e.timeInfo=new e.TimeInfo(0,0,1e3/30),e.on=function(t){t&&(e.fps=t)},e.off=function(){},e.frameHandler=function(t){var n,i;if(e.fps!=e.prefps&&(e.prefps=e.fps,e.timeInfo.interval=1e3/e.fps),e.timeInfo.time=t,!(0!=e.timeInfo.frame&&e.timeInfo.getIntervalCount()<1)){for(n=0;n<e.handlers.length;n+=1)i=e.handlers[n],i.timeInfo.time=t,(0==i.preframe||e.timeInfo.frame-i.preframe>=i.timeInfo.interval)&&(i.handler.call(i,i.timeInfo),i.timeInfo.frame+=1,i.timeInfo.preTime=t,i.preframe=e.timeInfo.frame);return e.timeInfo.preTime=t,e.timeInfo.frame+=1,!0}},e.add=function(t,n){var i=e.get(t);return null==i?(i=new e.HandlerInfo(t,n),e.handlers.push(i)):n&&(i.timeInfo.interval=n),i},e.remove=function(t){var n,i=e.get(t);return i&&(n=e.handlers.indexOf(i),e.handlers.splice(n,1)),i},e.handlers=[],e.get=function(t){var n,i;for(n=e.handlers.length-1;n>=0;n-=1)if(i=handlers[n],i&&i.handler==t)return i;return null},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=JSA.FPS),exports.JSA.FPS=e):t.JSA.FPS=e}}.call(this),function(){"use strict";if("undefined"==typeof JSA.JSAAnimation){JSA.textureHandler=function(t){var e=t.texture;return e||(e=t.texture={frameData:{res:t.pack.path,x:t.offset[0],y:t.offset[1]},textureData:{x:t.textureOffset[0],y:t.textureOffset[1],w:t.textureOffset[2],h:t.textureOffset[3]}}),e},JSA.JSAAnimation=function(t){var e,n,i,a=[],o={},r={},s=new egret.MovieClipData;if(this.timeInfo=new JSA.FPS.TimeInfo(0,0,0),t&&t.items){for(e=0;e<t.items.length;e+=1)n=t.items[e],n.data&&n.type==JSA.JSAType.FILE&&JSA.isTexture(n.data.type)&&(i=n.data.loadImage(),a.push(i.frameData),r[n.path]=i.textureData);t.info&&t.info.fps&&(this.timeInfo.interval=1e3/t.info.fps),s.spriteSheet=t.jsa.zip,s.textureData=r,o.frames=a,s.mcData=o}egret.MovieClip.call(this,s)},JSA.JSAAnimation.prototype=Object.create(egret.MovieClip.prototype),JSA.JSAAnimation.prototype.constructor=JSA.JSAAnimation,JSA.JSAAnimation.prototype.advanceTime=function(t){var e=this;e.timeInfo.time=t;var n=1;if(e.timeInfo.interval&&e.timeInfo.preTime&&(n=e.timeInfo.getIntervalCount()),0==n)return!1;for(;n>=1;){if(n--,e.$nextFrameNum++,e.$nextFrameNum>e.$totalFrames||e.$frameLabelStart>0&&e.$nextFrameNum>e.$frameLabelEnd)if(-1==e.playTimes)e.$eventPool.push(egret.Event.LOOP_COMPLETE),e.$nextFrameNum=1;else{if(e.playTimes--,!(e.playTimes>0)){e.$nextFrameNum=e.$totalFrames,e.$eventPool.push(egret.Event.COMPLETE),e.stop();break}e.$eventPool.push(egret.Event.LOOP_COMPLETE),e.$nextFrameNum=1}e.$currentFrameNum==e.$frameLabelEnd&&(e.$nextFrameNum=e.$frameLabelStart),e.advanceFrame()}return e.constructFrame(),e.handlePendingEvent(),e.timeInfo.preTime=e.timeInfo.time,!1},JSA.JSAContainer=function(){egret.DisplayObjectContainer.call(this),this.animations=[]},JSA.JSAContainer.prototype=Object.create(egret.DisplayObjectContainer.prototype),JSA.JSAContainer.prototype.constructor=JSA.JSAContainer,JSA.JSAContainer.prototype.addAnimation=function(t,e){var n=this.animations.indexOf(t);return 0>n&&(e&&this.animations.length>0?t.gotoAndPlay(this.animations[0].currentFrame,-1):t.gotoAndPlay(0,-1),this.addChild(t),this.animations.push(t)),t},JSA.JSAContainer.prototype.removeAnimation=function(t,e){var n=this.animations.indexOf(t);return n>=0&&(t.stop(),e||this.removeChild(t),this.animations.splice(n,1)),t},JSA.JSAContainer.prototype.removeAnimations=function(t){var e=this.animations,n=e.length-1;for(n;n>=0;n-=1)this.removeAnimation(e[n],t)},JSA.JSAContainer.prototype.removeChildren=function(){this.removeAnimations(!0),egret.DisplayObjectContainer.prototype.removeChildren.call(this)}}}.call(this);